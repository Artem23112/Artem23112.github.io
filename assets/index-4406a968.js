import{j as s,r as u,R as vt}from"./react-f17a95de.js";import{c as ue}from"./react-dom-61bf0eba.js";import{u as pe,a as me,P as he}from"./react-redux-ae3bbc54.js";import{L as lt,B as fe}from"./react-router-dom-a55787a0.js";import{l}from"./runtypes-fe95303d.js";import{g,u as it,a as f,o as Z,b as $,s as A,A as N,c as _e,d as O,e as xe,f as ge,h as be,i as je,j as Se,k as ye,l as we}from"./@firebase-01e90a33.js";import{h as y}from"./moment-1841ed88.js";import{c as S,a as G,b as ve}from"./@reduxjs-0dff851b.js";import{v as M}from"./uuid-4a60fe23.js";import"./hoist-non-react-statics-d052b204.js";import"./react-is-a192e302.js";import{d as X,b as De,e as Dt,f as k,a as dt,g as Ie}from"./react-router-00cdfa21.js";import{c as _}from"./clsx-1229b3e0.js";import{_ as Ne}from"./moment-with-locales-es6-62e28ada.js";import{R as Ce}from"./react-quill-439a743d.js";import{C as $e}from"./react-calendar-40236c03.js";import{B as It,a as Nt}from"./react-icons-47ef72c9.js";import{R as Ct}from"./react-paginate-b0ba4c82.js";import"./firebase-d6c7c155.js";import"./scheduler-765c72db.js";import"./use-sync-external-store-0efa3301.js";import"./@remix-run-1dd2da88.js";import"./idb-81bdbf9b.js";import"./immer-41fd5235.js";import"./redux-550d7e81.js";import"./@babel-c7024f36.js";import"./redux-thunk-ef899f4c.js";import"./lodash-e13e2920.js";import"./quill-75e17b9d.js";import"./prop-types-1287e13b.js";import"./get-user-locale-32ab7647.js";import"./lodash.memoize-81ef9c90.js";import"./@wojtekmaj-0fa81e45.js";import"./tiny-warning-c932d744.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const a of o)if(a.type==="childList")for(const i of a.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&r(i)}).observe(document,{childList:!0,subtree:!0});function n(o){const a={};return o.integrity&&(a.integrity=o.integrity),o.referrerPolicy&&(a.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?a.credentials="include":o.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function r(o){if(o.ep)return;o.ep=!0;const a=n(o);fetch(o.href,a)}})();const $t=e=>l.Intersect(e,l.Record({id:l.String})),Pe=l.Union(l.Literal("enrolled"),l.Literal("admitted"),l.Literal("not-admitted"),l.Literal("expired")),Pt=l.Record({status:Pe,fullDateISO:l.String}),Ae=l.Record({patientId:l.String,fullDateISO:l.String,record:l.String,doctorId:l.String}),At=l.Dictionary(Ae,l.String),Tt=l.Record({name:l.String,specialization:l.String,additional:l.Record({education:l.String,experience:l.String})}),Te=$t(Tt),Rt=l.Dictionary(Tt,l.String),Re=l.Intersect(Pt,l.Record({userId:l.String})),ut=l.Dictionary(Re,l.String),ke=l.Dictionary(l.Boolean,l.String),kt=async(e,t,n)=>{e.forEach(r=>{if(y(r.fullDateISO).isBefore(y())&&r.status==="enrolled"){const o=g(),a=`${n==="admin"?"doctors":"users"}/${t}/appointments/${r.id}/`;it(f(o,a),{status:"expired"})}})},D=e=>e instanceof Object?Object.entries(e).map(([n,r])=>({id:n,...r})):[],Et=e=>e.sort((t,n)=>t.fullDateISO.localeCompare(n.fullDateISO));function Ee(e,t){const n=f(g(),`doctors/${t}/appointments`);Z(n,async r=>{const o=r.val();if(!ut.guard(o))return;const a=D(o);await kt(a,t,"admin");const i=Et(a);e(He(i))})}function Le(e,t){const n=f(g(),`doctors/${t}/my-patients`);Z(n,async r=>{const o=r.val();if(!ke.guard(o))return;const a=Object.keys(o);e(qe(a))})}const Lt=l.Record({name:l.String}),Oe=$t(Lt),Me=l.Dictionary(Lt,l.String),Fe=l.Intersect(Pt,l.Record({doctorId:l.String})),Be=l.Dictionary(Fe,l.String),Ot=S("doctorSlice/doctorConnectToServer",async(e,{dispatch:t,rejectWithValue:n})=>{Ee(t,e),Le(t,e);const r=f(g(),"users-info"),o=(await $(r)).val();if(!Me.guard(o))return n("unknown type info about users");const a=f(g(),"doctors-info"),i=(await $(a)).val();return Rt.guard(i)?{usersInfo:D(o),doctorsInfo:D(i)}:n("")}),E=S("doctorSlice/getMedicalCard",async(e,{rejectWithValue:t})=>{const n=g(),r=f(n,`users-info/${e}/medical-records`);try{const o=await $(r),a=o.val();if(!o.exists()||!At.guard(a))throw Error();return D(a)}catch{return t("")}}),Ue={appointments:[],usersInfo:[],doctorsInfo:[],doctorPatients:[],medicalCard:[],isLoading:!1},Mt=G({name:"doctorSlice",initialState:Ue,reducers:{setDoctorAppointments(e,t){e.appointments=t.payload},setDoctorPatients(e,t){e.doctorPatients=t.payload}},extraReducers:e=>{e.addCase(Ot.fulfilled,(t,n)=>{t.usersInfo=n.payload.usersInfo,t.doctorsInfo=n.payload.doctorsInfo}).addCase(E.pending,t=>{t.isLoading=!0}).addCase(E.fulfilled,(t,n)=>{t.medicalCard=n.payload,t.isLoading=!1}).addCase(E.rejected,t=>{t.medicalCard=[],t.isLoading=!1})}}),{setDoctorAppointments:He,setDoctorPatients:qe}=Mt.actions,ze=Mt.reducer,Ft=S("patientSlice/getMedicalCard",async(e,{rejectWithValue:t,getState:n})=>{const r=g(),a=n().authentication.id,i=f(r,`users-info/${a}/medical-records`);try{const c=await $(i),d=c.val();if(!c.exists()||!At.guard(d))throw Error();return D(d)}catch{return t("")}}),We=[],Bt=G({name:"popup-messages",initialState:We,reducers:{addMessage(e,t){e.push(t.payload)},removeMessage(e,t){return e.filter(n=>n.id!==t.payload)}}}),L=S("popup-messages/show",async(e,{dispatch:t})=>{const n={...e,id:M()};t(Ye(n)),await new Promise(r=>{(n==null?void 0:n.duration)!==0&&setTimeout(()=>{t(Ut(n.id)),r("success")},(n==null?void 0:n.duration)||3e3)})}),{addMessage:Ye,removeMessage:Ut}=Bt.actions,Ve=Bt.reducer,Ke=async e=>{const t=g(),n=f(t,`doctors/${e}/appointments`),r=await $(n),o=r.val();if(!r.exists())return[];if(!ut.guard(o))throw new Error("unknown type of doctor appointment data");return D(o).map(c=>c.fullDateISO)},Qe=async(e,t)=>({isExists:(await Ke(e)).some(o=>o===t)}),Ze=(e,t)=>{const n=y(t,"HH:mm");return y(e).hours(n.hours()).minutes(n.minutes()).seconds(0).milliseconds(0).toISOString()},Ht=S("patientSlice/sendApplication",async(e,{getState:t,dispatch:n,rejectWithValue:r})=>{const o=t(),{chosenDoctor:a,chosenDate:i,chosenTime:c}=o.patientSlice.appointmentData;if(!a||!i||!c)return n(L({text:"Извините, но вы выбрали не все, что необходимо для записи",type:"warning"})),r("Данных недостаточно");const d=g(),b=Ze(i,c),h=o.authentication.id,I={status:"enrolled",fullDateISO:b},B=M(),tt=f(d,`doctors/${a}/appointments/${B}`),et=f(d,`users/${h}/appointments/${B}`);try{const{isExists:st}=await Qe(a,b);if(st)throw new Error("Запись на данное число уже есть");A(tt,{...I,userId:h}),A(et,{...I,doctorId:a}),n(L({text:"Вы записались к врачу",type:"success"}))}catch(st){const de=st.message||"Упс, что-то пошло не так, записаться не удалось";return n(L({text:de,type:"error"})),r("")}}),Ge={userAppointments:[],doctorsInfo:[],usersInfo:[],isSuccessSubmit:!1,busyDates:[],appointmentData:{chosenDoctor:null,chosenDate:null,chosenTime:null},medicalRecords:[]},qt=G({name:"patientSlice",initialState:Ge,reducers:{setPatientAppointments(e,t){e.userAppointments=t.payload},setBusyDates(e,t){e.busyDates=t.payload},clearSubmitStatus(e){e.isSuccessSubmit=!1},setChosenAppointmentData(e,t){e.appointmentData={...e.appointmentData,...t.payload}}},extraReducers:e=>{e.addCase(mt.fulfilled,(t,n)=>{t.doctorsInfo=n.payload}).addCase(Ht.fulfilled,t=>{t.isSuccessSubmit=!0,t.appointmentData={chosenDoctor:null,chosenDate:null,chosenTime:null}}).addCase(Ft.fulfilled,(t,n)=>{t.medicalRecords=n.payload})}}),zt=e=>e.patientSlice.doctorsInfo,Xe=e=>e.patientSlice.isSuccessSubmit,Je=e=>e.patientSlice.busyDates,ts=e=>e.patientSlice.appointmentData.chosenDoctor,Wt=e=>e.patientSlice.appointmentData.chosenDate,es=e=>e.patientSlice.appointmentData.chosenTime,{setPatientAppointments:ss,clearSubmitStatus:ns,setBusyDates:_t,setChosenAppointmentData:pt}=qt.actions,rs=qt.reducer;function os(e,t){const n=f(g(),`users/${t}/appointments`);Z(n,async r=>{const o=r.val();if(!Be.guard(o))return;const a=D(o);await kt(a,t,"user");const i=Et(a);e(ss(i))})}const mt=S("patientSlice/patientConnectToServer",async(e,{dispatch:t,rejectWithValue:n})=>{os(t,e),t(Ft());const r=f(g(),"doctors-info"),o=(await $(r)).val();return Rt.guard(o)?D(o):n("unknown type info about doctors")}),K=S("authentication/connect",async(e,{dispatch:t,rejectWithValue:n,getState:r})=>{try{const a=r().authentication.id;if(!a)throw new Error("Пользователь не авторизован");return(await $(f(g(),`doctors-info/${a}`))).exists()?(t(Ot(a)),"admin"):(t(mt(a)),"user")}catch(o){return n(o.code)}}),ht=e=>{switch(e){case N.INVALID_EMAIL:return{type:"email-error",message:"Неверный формат email."};case N.EMAIL_EXISTS:return{type:"email-error",message:"Email уже используется другим пользователем."};case N.USER_DELETED:return{type:"email-error",message:"Пользователь с указанным email не найден."};case N.USER_DISABLED:return{type:"email-error",message:"Учетная запись пользователя отключена."};case N.WEAK_PASSWORD:return{type:"pw-error",message:"Слабый пароль."};case N.INVALID_PASSWORD:return{type:"pw-error",message:"Неверный пароль."};case N.NETWORK_REQUEST_FAILED:return{type:"error",message:"Кажется какие-то проблемы с сетью."};case N.TOO_MANY_ATTEMPTS_TRY_LATER:return{type:"error",message:"Сервер слишком нагружен, попробуйте позже."};case null:return{type:null,message:null};default:return{type:"error",message:"Извините произошла какая-то ошибка, перезагрузите страницу"}}},W=S("authentication/exit",async(e,{rejectWithValue:t})=>{try{await _e(O())}catch(n){return t({...ht(n.code)})}}),Y=S("authentication/signIn",async({email:e,password:t},{rejectWithValue:n,dispatch:r})=>{try{const{user:o}=await xe(O(),e,t);return r(K()),{email:o.email,id:o.uid}}catch(o){return n({error:ht(o.code)})}}),V=S("authentication/signUp",async({email:e,password:t,name:n},{rejectWithValue:r,dispatch:o})=>{try{const{user:a}=await ge(O(),e,t),i=a.uid;return await A(f(g(),`users-info/${i}/rights`),"user"),await A(f(g(),`users-info/${i}/name`),n),o(mt(i)),{email:a.email,id:i}}catch(a){return r({error:{...ht(a.code),page:"/signup"}})}}),as={email:null,id:null,isAuth:!1,rights:null,loading:!1,error:null},Yt=G({name:"authentication",initialState:as,reducers:{setSavedUser(e,t){const{email:n,id:r,isAuth:o}=t.payload;e.error=null,e.email=n,e.id=r,e.isAuth=o},clearError(e){e.error=null}},extraReducers:e=>{e.addCase(V.fulfilled,(t,n)=>{const{email:r,id:o}=n.payload;t.email=r,t.id=o,t.isAuth=!0,t.loading=!1,t.error=null}).addCase(Y.fulfilled,(t,n)=>{const{email:r,id:o}=n.payload;t.email=r,t.id=o,t.isAuth=!0,t.loading=!1,t.error=null}).addCase(W.fulfilled,t=>{t.email=null,t.id=null,t.isAuth=!1,t.rights=null,t.loading=!1,t.error=null}).addCase(K.fulfilled,(t,n)=>{t.rights=n.payload}).addMatcher(t=>t.type===V.pending.type||t.type===Y.pending.type||t.type===W.pending.type,t=>{t.loading=!0}).addMatcher(t=>t.type===V.rejected.type||t.type===Y.rejected.type||t.type===W.rejected.type||t.type===K.rejected.type,(t,n)=>{t.error=n.payload.error,t.loading=!1})}}),Vt=e=>e.authentication.loading,Kt=e=>e.authentication.error,{setSavedUser:is,clearError:Qt}=Yt.actions,cs=Yt.reducer,ls=ve({reducer:{authentication:cs,doctorSlice:ze,patientSlice:rs,popupMessage:Ve},devTools:!0}),w=pe,p=me,Zt=({children:e})=>p(n=>n.authentication.isAuth)?s.jsx(s.Fragment,{children:e}):s.jsx(X,{to:"/login"}),ds=e=>be(O(),n=>{n&&(e(is({email:n.email,id:n.uid,isAuth:!0})),e(K()))}),us="_wrapper_1e9ia_3",ps={wrapper:us},Gt=({contentText:e,linkText:t,redirectPath:n,handleClick:r})=>s.jsxs("p",{className:ps.wrapper,children:[e,s.jsx(lt,{to:n,onClick:r,children:t})]}),ms="_btn_15hr8_10",hs="_input_15hr8_27",fs="_err_15hr8_3",nt={"err-message":"_err-message_15hr8_3",btn:ms,input:hs,err:fs},ct=({className:e,isError:t,errMessage:n,...r})=>s.jsxs("label",{children:[t&&s.jsx("span",{className:nt["err-message"],children:n}),s.jsx("input",{className:_(nt.input,{[nt.err]:t},e),...r})]}),_s="_form_1stak_3",xs="_btn_1stak_9",gs={form:_s,btn:xs},Xt=({children:e,submitBtnContent:t,submitHandler:n,error:r})=>{const[o,a]=u.useState(""),[i,c]=u.useState(""),d=(r==null?void 0:r.type)==="email-error",b=(r==null?void 0:r.type)==="pw-error";return s.jsxs("form",{onSubmit:h=>{h.preventDefault(),n(o,i)},children:[e,s.jsx(ct,{type:"email",value:o,onChange:h=>a(h.target.value),placeholder:"Логин",isError:d,errMessage:r==null?void 0:r.message,required:!0}),s.jsx(ct,{type:"password",value:i,onChange:h=>c(h.target.value),placeholder:"Пароль",isError:b,errMessage:r==null?void 0:r.message,required:!0}),s.jsx("button",{className:gs.btn,type:"submit",children:t})]})},bs="_loader_1gmtn_3",js="_rotation_1gmtn_1",Ss={loader:bs,rotation:js},ft=({size:e,color:t})=>{const n={width:`${e}px`,height:`${e}px`,borderWidth:`${Math.floor(e/10)}px`,borderColor:t,borderBottomColor:"transparent"};return s.jsx("span",{className:Ss.loader,style:n})},ys="_container_pbous_3",ws={container:ys},F=({children:e,className:t})=>s.jsx("div",{className:_(ws.container,t),children:e}),m={home:"/",login:"/login",singUp:"/signup",profile:{home:"/profile/",makeAppointment:"make-appointment/",appointmentList:"appointment-list/",myPatients:"my-patients/"}},vs="_title_hrqi1_16",xt={"login-wrapper":"_login-wrapper_hrqi1_3",title:vs,"err-message":"_err-message_hrqi1_23"},Ds=()=>{const e=w(),t=p(Vt),n=p(Kt);function r(o,a){e(Y({email:o,password:a}))}return s.jsx(F,{children:s.jsxs("div",{className:xt["login-wrapper"],children:[s.jsx("h3",{className:xt.title,children:"Вход в аккаунт"}),s.jsx(Xt,{submitBtnContent:t?s.jsx(ft,{size:24,color:"#fff"}):"Войти",submitHandler:r,error:n}),s.jsx(Gt,{contentText:"Нет аккаунта?",linkText:"Регистрация",redirectPath:m.singUp,handleClick:()=>e(Qt())})]})})},Q=({requiredRights:e,children:t})=>{const n=p(r=>r.authentication.rights);return s.jsx(s.Fragment,{children:e===n&&s.jsx(s.Fragment,{children:t})})},Is="_tab_1uvki_3",Ns="_active_1uvki_12",Cs="_shadow_1uvki_34",U={"tab-list":"_tab-list_1uvki_3",tab:Is,active:Ns,shadow:Cs},Jt=({tabsConfig:e})=>{const{pathname:t}=De();function n(r){return t.includes(r)}return s.jsxs(s.Fragment,{children:[s.jsx("ul",{className:U["tab-list"],children:e.map(r=>{if(!(r!=null&&r.default))return s.jsx("li",{className:_(U.tab,{[U.active]:n(r.linkPath)}),children:s.jsx(lt,{to:r.linkPath,children:r==null?void 0:r.tabText})},r.id)})}),s.jsx("div",{className:U.shadow,children:s.jsx(Dt,{children:e.map(r=>s.jsx(k,{path:r==null?void 0:r.routePath,element:r.component},r.id))})})]})},$s=S("doctorSlice/addToOwnPatients",async(e,{getState:t,rejectWithValue:n,fulfillWithValue:r})=>{const o=g(),i=t().authentication.id,c=f(o,`doctors/${i}/my-patients/${e}`);if((await $(c)).exists())return r("already added");try{await A(c,!0)}catch{return n("something went wrong")}}),Ps=S("doctorSlice/doctorAnswer",async({userId:e,appointmentId:t,type:n},{getState:r,dispatch:o})=>{const i=r().authentication.id,c=g(),d=f(c,`users/${e}/appointments/${t}`),b=f(c,`doctors/${i}/appointments/${t}`);try{await it(d,{status:n}),await it(b,{status:n})}catch{o(L({text:"Упс, что-то пошло не так",type:"error"}))}}),As="_wrapper_9nua0_3",Ts="_active_9nua0_35",Rs="_title_9nua0_38",ks="_additional_9nua0_39",Es="_time_9nua0_40",Ls="_icon_9nua0_66",Os="_status_9nua0_73",Ms="_enrolled_9nua0_76",Fs="_admitted_9nua0_79",Bs="_accept_9nua0_120",Us="_cancel_9nua0_126",j={wrapper:As,"functional-btns-wrapper":"_functional-btns-wrapper_9nua0_29","btn-delete":"_btn-delete_9nua0_32",active:Ts,title:Rs,additional:ks,time:Es,icon:Ls,status:Os,enrolled:Ms,admitted:Fs,"not-admitted":"_not-admitted_9nua0_82","functional-btn":"_functional-btn_9nua0_29",accept:Bs,cancel:Us},Hs=({id:e,userId:t})=>{const n=w();function r(o){t&&(o==="admitted"&&n($s(t)),n(Ps({userId:t,appointmentId:e,type:o})))}return s.jsxs("div",{className:j["functional-btns-wrapper"],children:[s.jsx("button",{className:_(j["functional-btn"],j.accept),onClick:()=>{r("admitted")},children:"Пациент принят"}),s.jsx("button",{className:_(j["functional-btn"],j.cancel),onClick:()=>{r("not-admitted")},children:"Пациент не пришел"})]})},qs=({className:e,name:t,specialization:n})=>s.jsxs("span",{className:_(e),children:[s.jsx("h4",{className:j.title,children:t}),n&&s.jsx("p",{className:j.additional,children:n})]}),te="/assets/close-a79845a6.svg",zs=S("appointments",async(e,{getState:t,dispatch:n})=>{const r=t(),o=r.authentication.id,a=r.authentication.rights,i=f(g(),`${a==="user"?"users":"doctors"}/${o}/appointments/${e}`);try{await je(i)}catch{n(L({text:"Не удалось удалить запись",type:"error"}))}}),Ws=({id:e})=>{const t=w();return s.jsx("button",{className:j["btn-delete"],onClick:()=>{t(zs(e))},children:s.jsx("img",{src:te})})},Ys=e=>({enrolled:"Записан",admitted:"Был принят","not-admitted":"Не принят",expired:"Запись просрочена"})[e],Vs=e=>({enrolled:"Вы записаны",admitted:"Вы были приняты","not-admitted":"Вы не были приняты",expired:"Запись просрочена"})[e],Ks=({status:e})=>s.jsxs("div",{className:_(j.status,j[e]),children:[s.jsx(Q,{requiredRights:"admin",children:Ys(e)}),s.jsx(Q,{requiredRights:"user",children:Vs(e)})]}),Qs="/assets/calendar-2620e6bf.svg",Zs="/assets/time-f0281237.svg",Gs=(e,t)=>{if(!e)return[null,null];const[n,r]=u.useState(null),[o,a]=u.useState(null);return u.useEffect(()=>{const i=Ne(e).locale("ru"),c=i.format("D MMMM YYYY"),d=`${i.format("HH:mm")} - ${i.add(t.count,t.what).format("HH:mm")}`;r(c),a(d)},[e]),[n,o]},Xs=({className:e,fullDateISO:t,textDate:n,textTime:r})=>{const[o,a]=Gs(t,{count:30,what:"minutes"});return s.jsx("div",{className:_(j.time,e),children:s.jsxs("div",{children:[s.jsxs("span",{children:[s.jsx("img",{className:j.icon,src:Qs}),o||n]}),s.jsxs("span",{children:[s.jsx("img",{className:j.icon,src:Zs}),a||r]})]})})},x=({className:e,children:t,active:n,handleClick:r})=>s.jsx("div",{className:_(e,j.wrapper,{[j.active]:n}),style:{cursor:n==!1||n==!0?"pointer":""},onClick:()=>r==null?void 0:r(),children:t});x.About=qs;x.TimeInfo=Xs;x.DeleteBtn=Ws;x.Status=Ks;x.AnswerBtns=Hs;function J(e,t){return e.find(n=>n.id===t)}const Js="_list_15mih_15",tn="_link_15mih_21",en="_card_15mih_25",sn="_about_15mih_25",T={"search-input":"_search-input_15mih_3",list:Js,link:tn,card:en,about:sn},nn=({data:e,patientsInfo:t})=>{const[n,r]=u.useState(""),[o,a]=u.useState([]);return u.useEffect(()=>{a(e.filter(i=>{var h;const c=J(t,i),d=(h=c==null?void 0:c.name)==null?void 0:h.toLowerCase(),b=n.toLowerCase();return d==null?void 0:d.includes(b)}))},[n]),{setSearchName:r,filteredData:o,searchName:n}},rn=({})=>{const e=p(a=>a.doctorSlice.doctorPatients),t=p(a=>a.doctorSlice.usersInfo),{filteredData:n,searchName:r,setSearchName:o}=nn({data:e,patientsInfo:t});return s.jsxs(s.Fragment,{children:[s.jsx("input",{className:T["search-input"],type:"text",value:r,onChange:a=>o(a.target.value),placeholder:"Введите имя пациента"}),s.jsx("ul",{className:T.list,children:n.map(a=>{const i=J(t,a);return i?s.jsx("li",{children:s.jsx(lt,{className:T.link,to:`/profile/my-patients/${a}`,children:s.jsx(x,{className:T.card,children:s.jsx(x.About,{className:T.about,name:i.name})})})},a):s.jsx(u.Fragment,{},a)})})]})},on=({className:e=""})=>{const t=dt(),n=()=>{t(-1)},r={display:"flex",alignItems:"center",juctifyContent:"center",padding:"8px 20px 10px",backgroundColor:"white",color:"#006ed0",fontSize:"30px",lineHeight:"30px",border:"none",borderRadius:"5px",cursor:"pointer",fontWeight:"bold",boxShadow:"0 -1px 4px rgba(0, 0, 0, 0.1)",transition:"background-color 0.3s ease"},o=()=>{n()};return s.jsx("button",{className:_(e),style:r,onClick:o,children:"←"})},an="_btn_4tu26_3",cn={btn:an},ee=({className:e,children:t,onClick:n})=>s.jsx("button",{className:_(e,cn.btn),onClick:n,children:t}),ln=({htmlContent:e,className:t})=>s.jsx("div",{className:_(t),dangerouslySetInnerHTML:{__html:e}}),dn="_record_6g619_1",un="_name_6g619_6",pn="_additional_6g619_11",P={record:dn,name:un,additional:pn,"report-header":"_report-header_6g619_17","html-wrapper":"_html-wrapper_6g619_35"},se=({record:e,doctorInfo:t})=>s.jsxs("div",{className:P.record,children:[s.jsxs("div",{className:P["report-header"],children:[s.jsx("h4",{className:P.name,children:t==null?void 0:t.name}),s.jsx("h5",{className:P.additional,children:t==null?void 0:t.specialization})]}),s.jsx(ln,{className:P["html-wrapper"],htmlContent:e.record})]},e.id);function ne(e,t){return e.find(n=>n.id===t)}const mn=({})=>{const e=p(n=>n.doctorSlice.medicalCard),t=p(n=>n.doctorSlice.doctorsInfo);return s.jsx("div",{className:P.container,children:e.map(n=>{const r=ne(t,n.doctorId);return s.jsx(se,{record:n,doctorInfo:r},n.id)})})},hn=({value:e,setValue:t})=>s.jsx(Ce,{style:{height:"300px"},theme:"snow",value:e,onChange:t}),fn=S("doctorSlice/addRecordToCard",async(e,{getState:t,rejectWithValue:n})=>{const r=g(),o=f(r,`users-info/${e.patientId}/medical-records/${M()}`),i=t().authentication.id,c={...e,doctorId:i};try{await A(o,c)}catch{return n("error")}}),_n="_title_1y3d6_5",xn="_btn_1y3d6_15",R={"back-button":"_back-button_1y3d6_1",title:_n,"btn-wrapper":"_btn-wrapper_1y3d6_15",btn:xn,"loader-wrapper":"_loader-wrapper_1y3d6_24"},gn=({patientId:e})=>{var c;const t=w(),n=p(d=>d.doctorSlice.isLoading),r=p(d=>d.doctorSlice.usersInfo),[o,a]=u.useState("");u.useEffect(()=>{t(E(e))},[]);function i(){const d={patientId:e,fullDateISO:y().toISOString(),record:o};a(""),t(fn(d)),t(E(e))}return s.jsxs(s.Fragment,{children:[s.jsxs("div",{children:[s.jsx(on,{className:R["back-button"]}),s.jsxs("h2",{className:R.title,children:[s.jsx("span",{children:"Пациент:"})," ",(c=J(r,e))==null?void 0:c.name]})]}),s.jsx(hn,{value:o,setValue:a}),s.jsx("div",{className:R["btn-wrapper"],children:s.jsx(ee,{className:R.btn,onClick:i,children:"Добавить запись"})}),n?s.jsx("div",{className:R["loader-wrapper"],children:s.jsx(ft,{color:"#006ed0",size:40})}):s.jsx(mn,{patientId:e})]})},bn="_wrapper_1m45x_1",jn={wrapper:bn},Sn=({})=>{const{patientId:e}=Ie();return s.jsx("div",{className:jn.wrapper,children:e?s.jsx(gn,{patientId:e}):s.jsx(rn,{})})},yn="/assets/arrow-60e4b77b.svg",wn="_active_1v3fb_35",v={"profile-btn-container":"_profile-btn-container_1v3fb_3","profile-btn":"_profile-btn_1v3fb_3","profile-btn__name":"_profile-btn__name_1v3fb_14","profile-btn__arrow":"_profile-btn__arrow_1v3fb_17","profile-btn__submenu":"_profile-btn__submenu_1v3fb_22",active:wn,"profile-btn__submenu-item":"_profile-btn__submenu-item_1v3fb_38"},vn=()=>{const e=p(a=>a.authentication.email),[t,n]=u.useState(!1),r=w(),o=u.useCallback(({target:a})=>{a instanceof HTMLElement&&(a.closest("."+v["profile-btn-container"])||n(i=>!i))},[]);return u.useEffect(()=>{if(!t){document.removeEventListener("click",o);return}return document.addEventListener("click",o),()=>{document.removeEventListener("click",o)}},[t,o]),s.jsxs("div",{className:v["profile-btn-container"],children:[s.jsxs("button",{className:v["profile-btn"],onClick:()=>{n(!t)},children:[s.jsx("span",{className:v["profile-btn__name"],children:e}),s.jsx("img",{className:v["profile-btn__arrow"],src:yn})]}),s.jsxs("ul",{className:`${v["profile-btn__submenu"]} ${t?v.active:""}`,children:[s.jsx("li",{className:v["profile-btn__submenu-item"],children:s.jsx("button",{children:"Параметры"})}),s.jsx("li",{className:v["profile-btn__submenu-item"],children:s.jsx("button",{onClick:()=>{r(W())},children:"Выход"})})]})]})},Dn="_header_1n6cy_3",rt={header:Dn,"header-content":"_header-content_1n6cy_7","header-title":"_header-title_1n6cy_12"},re=({title:e})=>s.jsx("div",{className:rt.header,children:s.jsx(F,{children:s.jsxs("div",{className:rt["header-content"],children:[s.jsx("h2",{className:rt["header-title"],children:e}),s.jsx(Zt,{children:s.jsx(vn,{})})]})})}),In="_btn_105nh_3",Nn="_active_105nh_24",H={"btns-wrapper":"_btns-wrapper_105nh_3","btn-wrapper":"_btn-wrapper_105nh_10",btn:In,active:Nn},Cn=({className:e,sortConfig:t,chosenFilter:n,handleClick:r})=>s.jsx("ul",{className:_(H["btns-wrapper"],e),children:t.map(o=>s.jsx("li",{className:H["btn-wrapper"],children:s.jsx("button",{className:_(H.btn,{[H.active]:n===o.filter}),onClick:()=>{r(o.filter)},children:o.btnText})},M()))});const oe=e=>s.jsx($e,{className:"react-calendar",...e}),ae=l.Union(l.InstanceOf(Date),l.Null),$n=(e,t,n)=>{const[r,o]=u.useState(t),[a,i]=u.useState([]),c=d=>y(d.fullDateISO).startOf("day").toISOString()===n;return u.useEffect(()=>{i(r==="all"?e.filter(c):e.filter(d=>d.status===r).filter(c))},[r,n,e]),{handledList:a,chosenFilter:r,setChosenFilter:o}},Pn="_container_mtx6b_3",An="_number_mtx6b_14",Tn="_active_mtx6b_21",Rn="_disabled_mtx6b_33",C={container:Pn,number:An,active:Tn,"arrow-btn":"_arrow-btn_mtx6b_26",disabled:Rn},ie={activeClassName:C.active,disabledClassName:C.disabled,containerClassName:C.container,pageClassName:C.number,previousClassName:_(C["arrow-btn"],C["prev-btn"]),nextClassName:_(C["arrow-btn"],C["next-btn"])},ce=({page:e,countItemsOnPage:t,data:n})=>{const[r,o]=u.useState(e),[a,i]=u.useState([]);return u.useEffect(()=>void o(0),[n]),u.useEffect(()=>{i(n.filter((c,d)=>d>=r*t&&d<(r+1)*t))},[r,n]),{setCurrentPage:o,itemsToRender:a,currentPage:r}},kn="_message_5iue8_8",gt={"appointments-list":"_appointments-list_5iue8_3",message:kn},En=({className:e,doctorAppointments:t})=>{const n=p(c=>c.doctorSlice.usersInfo),r=4,{itemsToRender:o,currentPage:a,setCurrentPage:i}=ce({data:t,countItemsOnPage:r,page:1});return s.jsxs("ul",{className:_(gt["appointments-list"],e),children:[o.map((c,d)=>{const b=J(n,c.userId);return Oe.guard(b)?s.jsx("li",{children:s.jsxs(x,{children:[c.status==="enrolled"&&s.jsx(x.AnswerBtns,{id:c.id,userId:c.userId}),s.jsx(x.About,{name:b.name}),s.jsx(x.TimeInfo,{fullDateISO:c.fullDateISO}),s.jsx(x.Status,{status:c.status})]})},c.id):s.jsx(u.Fragment,{},d)}),s.jsx(Ct,{forcePage:a,pageCount:Math.ceil(t.length/r),onPageChange:c=>i(c.selected),renderOnZeroPageCount:()=>s.jsx("p",{className:gt.message,children:!t.length&&"Нет записейл за выбранную дату и сортировку"}),nextLabel:s.jsx(It,{}),previousLabel:s.jsx(Nt,{}),...ie})]})},Ln="_wrapper_xtoys_1",On="_calendar_xtoys_7",q={wrapper:Ln,calendar:On,"sort-btns-wrapper":"_sort-btns-wrapper_xtoys_19","appointment-list":"_appointment-list_xtoys_24"},Mn=[{filter:"all",btnText:"Все"},{filter:"enrolled",btnText:"Записанные"},{filter:"admitted",btnText:"Принятые"},{filter:"not-admitted",btnText:"Не принятые"},{filter:"expired",btnText:"Просроченные"}],Fn=({doctorAppointments:e})=>{const[t,n]=u.useState(y().startOf("day").toISOString()),{handledList:r,chosenFilter:o,setChosenFilter:a}=$n(e,"all",t);return s.jsx(s.Fragment,{children:s.jsxs("div",{className:q.wrapper,children:[s.jsx(Cn,{className:q["sort-btns-wrapper"],sortConfig:Mn,chosenFilter:o,handleClick:a}),s.jsx(En,{className:q["appointment-list"],doctorAppointments:r}),s.jsx(oe,{className:q.calendar,value:y(t).toDate(),onChange:i=>ae.guard(i)&&n(y(i).toISOString())})]})})},Bn=()=>{const e=p(n=>n.doctorSlice.appointments);let t=[{id:1,tabText:"Список записей",linkPath:`${m.profile.home}${m.profile.appointmentList}`,routePath:`${m.profile.appointmentList}`,component:s.jsx(Fn,{doctorAppointments:e})},{id:2,tabText:"Мои пациенты",linkPath:`${m.profile.home}${m.profile.myPatients}`,routePath:`${m.profile.myPatients}:patientId?`,component:s.jsx(Sn,{})},{id:3,linkPath:"",routePath:`${m.home}`,component:s.jsx(X,{to:`./${m.profile.appointmentList}`}),default:!0}];return s.jsxs(s.Fragment,{children:[s.jsx(re,{title:"Добро пожаловать"}),s.jsx(F,{children:s.jsx(Jt,{tabsConfig:t})})]})},Un="_wrapper_13knd_3",Hn="_message_13knd_8",bt={wrapper:Un,message:Hn},qn=({})=>{const e=p(n=>n.patientSlice.medicalRecords),t=p(n=>n.patientSlice.doctorsInfo);return s.jsx("div",{className:bt.wrapper,children:e.length?e.map(n=>s.jsx(se,{record:n,doctorInfo:ne(t,n.doctorId)},n.id)):s.jsx("p",{className:bt.message,children:"У вас нет записей в медицинской карте"})})},zn="_btn_x82fc_3",Wn="_chosen_x82fc_27",ot={"btns-wrapper":"_btns-wrapper_x82fc_3",btn:zn,chosen:Wn},le=({from:e,to:t,stepSize:n,busyDates:r})=>{const o=w(),a=p(Wt),i=p(es),[c,d]=u.useState([]);u.useEffect(()=>{const h=[],I=y(a).hours(e.hours).minutes(e.minutes).seconds(0).milliseconds(0),B=y(I).hours(t.hours).minutes(t.minutes);for(;!I.isSameOrAfter(B);){const tt={text:I.format("HH:mm"),isDisabled:r.some(et=>et===I.toISOString())};h.push(tt),I.add(n.hours,"hours").add(n.minutes,"minutes")}d(h)},[e,t,n]);function b(h){o(pt({chosenTime:h}))}return s.jsx("div",{className:ot["btns-wrapper"],children:c.map(h=>s.jsx("button",{className:_(ot.btn,{[ot.chosen]:h.text===i}),disabled:h.isDisabled,onClick:()=>{b(h.text)},children:h.text},M()))})};vt.memo(le);const Yn="_title_g1ug0_3",at={title:Yn,"content-container":"_content-container_g1ug0_14","record-calendary":"_record-calendary_g1ug0_28"},Vn=()=>{const e=w(),t=p(Je),n=p(Wt),r=u.useMemo(()=>({from:{hours:8,minutes:0},to:{hours:17,minutes:0},stepSize:{hours:0,minutes:30},busyDates:t,chosenDate:n}),[t,n]);function o(a){ae.guard(a)&&a&&e(pt({chosenDate:a.toISOString()}))}return s.jsxs("div",{children:[s.jsx("h2",{className:at.title,children:"Выберите дату и время"}),s.jsxs("div",{className:at["content-container"],children:[s.jsx(oe,{className:at["record-calendar"],maxDate:y().add(1,"month").toDate(),minDate:y().add(1,"day").toDate(),maxDetail:"month",minDetail:"year",value:n&&y(n).toDate(),onChange:a=>{o(a)},tileDisabled:({date:a,view:i})=>i==="month"&&(a.getDay()===0||a.getDay()===6)}),n&&s.jsx(le,{...r})]})]})},Kn=S("appointments",async(e,{dispatch:t,rejectWithValue:n})=>{const r=f(g(),`doctors/${e}/appointments`);Z(r,o=>{const a=o.val();if(!o.exists())return t(_t([]));if(!ut.guard(a))return n("unknown type of doctor appointment data");const c=D(a).map(d=>d.fullDateISO);t(_t(c))})}),Qn="_title_e74vm_3",jt={title:Qn},Zn=({doctorsInfo:e})=>{const t=w(),n=p(ts);u.useEffect(()=>{n&&t(Kn(n))},[n]);function r(o){t(pt({chosenDoctor:o}))}return s.jsxs("div",{children:[s.jsx("h2",{className:jt.title,children:"Выберите врача"}),s.jsx("ul",{className:jt["doctor-list"],children:e.map(o=>s.jsx("li",{children:s.jsxs(x,{active:n===o.id,handleClick:()=>r(o.id),children:[s.jsx(x.About,{name:o.name,specialization:o.specialization}),s.jsx(x.TimeInfo,{textDate:"Пн-Пт",textTime:"8:00-17:00"})]})},o.id))})]})},St={"content-wrapper":"_content-wrapper_1u7nq_3"},Gn=()=>{const e=w(),t=dt(),n=p(zt),r=p(Xe);return u.useEffect(()=>{r&&(t(m.profile.home+m.profile.appointmentList),e(ns()))},[r]),s.jsx(s.Fragment,{children:s.jsxs("div",{className:St["content-wrapper"],children:[s.jsx(Zn,{doctorsInfo:n}),s.jsx(Vn,{}),s.jsx(ee,{className:_(St.end),onClick:()=>{e(Ht())},children:"Записаться"})]})})},Xn="_message_5iue8_8",yt={"appointments-list":"_appointments-list_5iue8_3",message:Xn},Jn=({className:e,userAppointments:t})=>{const n=p(zt),r=5,{itemsToRender:o,setCurrentPage:a}=ce({page:0,countItemsOnPage:r,data:t});return s.jsxs(s.Fragment,{children:[s.jsx("ul",{className:_(yt["appointments-list"],e),children:o.map(i=>{const c=n.find(d=>d.id===i.doctorId);return Te.guard(c)?s.jsx("li",{children:s.jsxs(x,{children:[s.jsx(x.About,{name:c.name,specialization:c.specialization}),s.jsx(x.TimeInfo,{fullDateISO:i.fullDateISO}),s.jsx(x.Status,{status:i.status}),s.jsx(x.DeleteBtn,{id:i.id})]})},i.id):s.jsx(u.Fragment,{},i.id)})}),s.jsx(Ct,{pageCount:Math.ceil(t.length/r),onPageChange:i=>a(i.selected),renderOnZeroPageCount:null,nextLabel:s.jsx(It,{}),previousLabel:s.jsx(Nt,{}),...ie}),!t.length&&s.jsx("p",{className:yt.message,children:"'У вас нет никаких записей'"})]})},tr=()=>{const e=p(n=>n.patientSlice.userAppointments),t=[{id:1,tabText:"Записаться",linkPath:m.profile.home+m.profile.makeAppointment,routePath:m.profile.makeAppointment,component:s.jsx(Gn,{})},{id:2,tabText:"Список записей",linkPath:m.profile.home+m.profile.appointmentList,routePath:m.profile.appointmentList,component:s.jsx(Jn,{userAppointments:e})},{id:3,tabText:"Медицинская карта",linkPath:m.profile.home+"my-medical-card",routePath:"/my-medical-card",component:s.jsx(qn,{})},{id:4,linkPath:"",routePath:"/",component:s.jsx(X,{to:m.profile.makeAppointment}),default:!0}];return s.jsxs(s.Fragment,{children:[s.jsx(re,{title:"Запишитесь на прием"}),s.jsx(F,{children:s.jsx(Jt,{tabsConfig:t})})]})},er=()=>s.jsxs("div",{children:[s.jsx(Q,{requiredRights:"user",children:s.jsx(tr,{})}),s.jsx(Q,{requiredRights:"admin",children:s.jsx(Bn,{})})]}),sr="_title_1xg3z_16",wt={"signup-wrapper":"_signup-wrapper_1xg3z_3",title:sr},nr=()=>{const[e,t]=u.useState(""),n=w(),r=p(Vt),o=p(Kt);function a(i,c){n(V({email:i,password:c,name:e}))}return s.jsx(F,{children:s.jsxs("div",{className:wt["signup-wrapper"],children:[s.jsx("h3",{className:wt.title,children:"Регистрация"}),s.jsx(Xt,{submitHandler:a,submitBtnContent:r?s.jsx(ft,{size:24,color:"#fff"}):"Зарегистрироваться",error:o&&{type:o.type,message:o.message},children:s.jsx(ct,{type:"name",value:e,onChange:i=>t(i.target.value),placeholder:"ФИО",required:!0})}),s.jsx(Gt,{contentText:"Уже есть аккаунт?",linkText:"Войти",redirectPath:m.login,handleClick:()=>n(Qt())})]})})},rr=()=>{const e=w(),t=p(({authentication:r})=>r.isAuth),n=dt();return u.useEffect(()=>{let r=ds(e);return()=>void r()},[]),u.useEffect(()=>{t&&n(m.profile.home)},[t]),s.jsx(s.Fragment,{children:s.jsxs(Dt,{children:[s.jsx(k,{path:m.home,element:s.jsx(X,{to:m.login})}),s.jsx(k,{path:m.login,element:s.jsx(Ds,{})}),s.jsx(k,{path:m.singUp,element:s.jsx(nr,{})}),s.jsx(k,{path:`${m.profile.home}*`,element:s.jsx(Zt,{children:s.jsx(er,{})})})]})})},or={error:"Ошибка",success:"Успех",warning:"Предупреждение",information:"Информация"},ar="_title_xtytf_14",ir="_error_xtytf_25",cr="_warning_xtytf_29",lr="_success_xtytf_33",dr="_information_xtytf_37",z={"popup-message":"_popup-message_xtytf_3",title:ar,"close-btn":"_close-btn_xtytf_19",error:ir,warning:cr,success:lr,information:dr},ur=({type:e,text:t,id:n})=>{const r=w();return s.jsxs("div",{className:_(z[e],z["popup-message"]),children:[s.jsxs("div",{children:[s.jsx("h4",{className:z.title,children:or[e]}),s.jsx("p",{children:t})]}),s.jsx("button",{className:z["close-btn"],type:"button",onClick:()=>{r(Ut(n))},children:s.jsx("img",{src:te})})]})},pr={"messages-wrapper":"_messages-wrapper_su4a9_1"},mr=()=>{const e=p(t=>t.popupMessage);return s.jsx("div",{className:pr["messages-wrapper"],children:e.map(t=>s.jsx(ur,{type:t.type,text:t.text,id:t.id},t.id))})},hr={apiKey:"AIzaSyDLCk35bsbIUHlSrrvkmWVb0OlLkEMRyBk",authDomain:"hospital-1651b.firebaseapp.com",projectId:"hospital-1651b",storageBucket:"hospital-1651b.appspot.com",messagingSenderId:"180699288079",appId:"1:180699288079:web:00e15fb90caaf4ca03c97a"},fr=Se(hr);ye(O(fr),we);ue.createRoot(document.getElementById("root")).render(s.jsx(vt.StrictMode,{children:s.jsxs(he,{store:ls,children:[s.jsx(mr,{}),s.jsx(fe,{children:s.jsx(rr,{})})]})}));
